// Copyright 2019, NXP Semiconductors
[[chapter]]
:numbered:
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################

== Introduction

=== Definition

=== Processor Architectures

=== Generic Architecture of an Embedded Linux System

=== Linked Setup

=== Standalone Setup

=== Solid State Storage Media (SD Card)



// #############################################################################
// #############################################################################
// #############################################################################

<<<

=== Preparing the i.MX 8M Mini EVK Board

The following section describes the steps to setup the _i.MX 8M Mini EVK Board_.

.i.MX 8M Mini EVK Board Top View
image::chapters/media/imx8mmevk_front.png[alt=.Top view i.MX 8M Mini EVK board, pdfwidth=80%, title-align=center, align=center]

.i.MX 8M Mini EVK Board Back View
image::chapters/media/imx8mmevk_back.png[alt=.Back view i.MX 8M Mini EVK board, pdfwidth=80%, title-align=center, align=center]

<<<

. Connect the _IMX-MIPI-HDMI Daughter Card_ to the _Mini-SAS Cable_ and into connector
labeled _DSI MIPI_ (`J801`) and then connect the _HDMI Monitor Cable_ into it.
+
.IMX-MIPI-HDMI Daughter Card
image::chapters/media/imx-mipi-hdmi.png[alt=.IMX-MIPI-HDMI daughter card, pdfwidth=25%, title-align=center, align=center]
+
. Connect the _MINISASTOCSI Camera Daughter Card_ to the _Mini-SAS Cable_ and into connector
labeled _CSI MIPI_ (`J802`).
+
.MINISASTOCSI Camera Daughter Card
image::chapters/media/minisas-to-csi.png[alt=.MINISASTOCSI Camera Daughter Card, pdfwidth=35%, title-align=center, align=center]
+
. Connect the _micro-B_ end of the supplied _USB Cable_ into _Debug UART_ port `J901`.
+
. Connect the other end of the cable to the _host GNU/Linux PC_.
+
. Insert the _MicroSD Card_ into the _MicroSD Card slot_ `J701` in the back board side.
To boot the board from the _MicroSD Card_, change the _Boot Switches_ `SW1101`
and `SW1102` (Figure 5) according to the table below:
+
.Boot Device Setting
[width="60%",cols="15,15,15",options="header", title-align=center, align=center]
|=========================================================
|BOOT Device    |SW1101     |SW1102
|MicroSD/uSDHC2 |0110110010 |0001101000
|=========================================================
+
.Boot Device Settings
image::chapters/media/boot_device_settings.png[alt=.Boot Device Settings, pdfwidth=30%, title-align=center, align=center]
+
. Connect the _Power Supply Cable_ to the _Power Connector_ `J302` and power **on** the
board by flipping the switch `SW101`.

[TIP%autofit]
====
For more details see https://www.nxp.com/products/processors-and-microcontrollers/arm-based-processors-and-mcus/i.mx-applications-processors/i.mx-8-processors/evaluation-kit-for-thebr-i.mx-8m-mini-applications-processor:8MMINILPD4-EVK?tab=In-Depth_Tab[i.MX 8M Mini EVK  Getting Started].
====

[%hardbreaks]


// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################

== Developing Tools

=== GNU Cross-Platform Development Toolchain

A _toolchain_ is a set of tools that compiles source codes generating executable binary
which can run on a specific target device. It includes a _compiler_, _linker_,
_run-time libraries_ and might also include a _debugger_. The _toolchain_ must
be able to compile codes written in _Assembly_, _C_ and _C++_ since these are the
most common languages used in the based open source packages.

[IMPORTANT%autofit]
====
The described procedures in this document target a _GNU/Linux_ (`Ubuntu 18.04.3 LTS`).
====

[CAUTION%autofit]
====
You need root privileges (sudo) to run a few commands described in this document.
====

==== Graphical Package Management

Avoid this step and go direct to _<<gcc_commandline>>_ if you prefer command lines.
This section can be used to search and install the cross-compiler packages using a _graphical tool_.

. Install a _Graphical Package Management_ and open it:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ apt-get install synaptic // <1>
$ synaptic // <2>
----
<1> using _apt-get_ package manager to install _synaptic_ tool.
<2> running _synaptic_ tool.
+
. Choose the following _toolchain_ and install it:
+
* **gcc-arm-linux-gnueabi**
+
[TIP%autofit]
====
Highly recommended to use the command lines to get familiar with _Unix environment_.
====

[[gcc_commandline]]
==== GCC Arm GNU/Linux Toolchain

. Install the _GCC_, _G++_ cross-compilers and support programs:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ apt-get install libc6-armel-cross libc6-dev-armel-cross binutils-arm-linux-gnueabi libncurses5-dev // <1>
----
<1> using _apt-get_ to install all the required packages for compiling.
+
. Install the specific cross-compilers to _i.MX_ processors:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ apt-get install gcc-arm-linux-gnueabi g++-arm-linux-gnueabi // <1>
----
<1> using _apt-get_ to install all the required packages for compiling.
+
. To export the cross-compiler, run the following environment variables:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ export ARCH=arm // <1>
$ export CROSS_COMPILE=/usr/bin/arm-linux-gnueabi- // <2>
----
<1> exporting environment variable for defining the platform.
<2> exporting environment variable for defining the cross-compiler binary.
+
[CAUTION%autofit]
====
These environment variables are only set for this shell and its child processes.
If the shell/terminal is **closed** and starts a new one, these settings will not be retained.
====

==== NXP Yocto Toolchain

The steps for installing a NXP toolchain generated by _Yocto_ is exactly simlar
for all releases. The daily buildings toolchain can be downloaded at:

* http://yb2.am.freescale.net/build-output/[_Internal YB2 Freescale Build Output_]

. Open a terminal on the _host GNU/Linux PC_, then:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ chmod +x <toolchain-version>.sh // <1>
----
<1> attributing execution permission to the toolchain.
+
. Install the _toolchain_ accepting all the default settings:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ sh ./<toolchain-version>.sh // <1>
----
<1> running the toolchain to be installed.
+
. To export Yocto toolchain:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ source /opt/fsl-imx-xwayland/<version>/environment-setup-aarch64-poky-linux  // <1>
----
<1> export the toolchain variables.
+
[CAUTION%autofit]
====
You must replace _<version>_ to the current toolchain version.
====
+
[TIP%autofit]
====
This toolchain is used to compile most of the _C_ and _C++_ applications.
====

==== Export the Environment

To easy export the environment variables from the above steps, follow the next instructions:

. To make it easier, follow the next instructions:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ touch ~/toolchain-variables.sh // <1>
$ echo "export ARCH=arm" >> ~/toolchain-variables.sh // <2>
$ echo "export CROSS_COMPILE=/usr/bin/arm-linux-gnueabi-" >> ~/toolchain-variables.sh // <3>
----
<1> create a file.
<2> write content to the file.
<3> write content to the file.
+
. Change the file permission and create a symbolic link:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ chmod +x ~/toolchain-variables.sh // <1>
$ ln -s ~/toolchain-variables /bin/go_arm // <2>
----
<1> applies execution permission to file.
<2> create symbolic link.
+
[CAUTION%autofit]
====
You need root privileges (sudo) to use `ln` command.
====
+
. Before compiling, run the following command:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ source go_arm // <1>
----
<1> export the toolchain variables.

<<<

=== Terminal Emulator

There are many serial communicators available you can use which one you prefer or
has more familiarity.

==== Minicom

. Open a terminal on the _host GNU/Linux PC_, then install the _Minicom_ tool:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ apt-get install minicom // <1>
----
<1> using _apt-get_ package manager to install _Minicom_ tool.
+
. Removing _root privileges_:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ adduser $USER dialout
$ chgrp dialout /etc/minicom/minirc.dft
$ chmod g+rw /etc/minicom/minirc.dft
----
+
[CAUTION%autofit]
====
Be careful using these commands.
====
+
. Go to _**serial port setup**_ and change the settings to:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ minicom -s
----
+
* Serial Device as: `/dev/ttyUSB0`
* Bps/Par/Bits as: `115200 8N1`
* Hardware Flow Control: `No`
* Software Flow Control: `No`
+
. Then, choose _**save setup as dfl**_, then _**exit**_.
+
. Connect the serial cable to the _i.MX Board_ and to the _host GNU/Linux PC_, then:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ minicom // <1>
----
<1> open `Minicom` with default settings.
+
. Turn the target board power switch to _**on**_, when it reaches the login prompt, enter: _**root**_

// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################

== Getting Started with NXP Linux BSP Release (4.19.35)

=== NXP BSP Release

You can download all the NXP Linux BSP Releases from https://www.nxp.com/design/i.mx-developer-resources/i.mx-software-and-development-tools:IMX-SW?&tid=vanIMX6TOOLS[_here_]. The BSP for _i.MX 8M Mini EVK Board_ is inside the _files_ folder located at _/opt_ directory.

. Uncompress the image:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ unzip L4.19.35_1.1.0_images_MX8MMEVK.zip
----
+
[CAUTION]
====
You need root privileges (sudo) to use `dd` for writing to _**/dev/sd<x>**_.
====
+
[IMPORTANT]
====
**_<x>_** refers to the SD Card device. You can check it using `lsblk` command.
====
+
. Flash the image into the SD Card device:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ dd if=imx-image-full-imx8mmevk.sdcard of=/dev/sdb bs=1M status=progress && sync
----




// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################
// #############################################################################

== Getting Started with i.MX Softwares

// #############################################################################
// #############################################################################
// #############################################################################

=== Bootloader

==== Software Requirement

. Install a few dependencies first:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ apt-get install bison flex
----

==== Prepare the Environment

. The cross-compiler must be exported before compiling the bootloader:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ source go_arm // <1>
----
<1> export the toolchain variables.

==== Compile the U-Boot

. Follow the steps to compile U-Boot for i.MX:
+
_Host GNU/Linux PC Terminal_
+
[source,bash]
----
$ git clone git://git.denx.de/u-boot-imx.git
$ cd u-boot-imx/
$ git checkout -b local_branch
$ make <board_name>
$ make
----

==== Flash the U-Boot to SD Card

// #############################################################################
// #############################################################################
// #############################################################################

=== Kernel

// #############################################################################
// #############################################################################
// #############################################################################

=== Root Filesystem

// #############################################################################
// #############################################################################
// #############################################################################





